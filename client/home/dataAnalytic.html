<div class="analytic-main">
  <div class="table-content">
    <div class="table-details">

    </div>
  </div>
  <div class="analytic-content">
    <div class="analytic-box">
      <p>Chọn loại dữ liệu:</p>
      <div class="select-box">
        <select id="category-analyse">
          <option value="" disabled selected>Danh mục</option>
          <option value="age">Độ tuổi</option>
          <option value="sex">Giới tính</option>
          <option value="education">Trình độ văn hóa</option>
          <option value="religion">Tôn giáo</option>
          <option value="population">Dân số</option>
        </select>
        <span class="custom-arrow"></span>
      </div>
    </div>
  </div>
  <div class="analytic-button">
    Phân tích
  </div>
</div>
<div class="chart-main">

</div>

<script type="module">
  const token = localStorage.getItem("a_token");
  const user = JSON.parse(window.atob(token.split('.')[1].replace('-', '+').replace('_', '/')));

  $(async () => {
    $(".table-details").data("departmentOnDisplay", user.username);

    if (user.roleId === 1) {
      $(".table-details").load("listCity.html");
    } else if (user.roleId === 2) {
      $(".table-details").load("listDistrict.html");
    } else if (user.roleId === 3) {
      $(".table-details").load("listWard.html");
    } else if (user.roleId === 4) {
      $(".table-details").load("listVillage.html");
    }
  });

  $(".analytic-button").click(async function () {
    const category = $("#category-analyse").val();

    if (category === 'population') {
      $.get("populationChart.html", function (data) {
        $(".chart-main").empty();
        $(".chart-main").append(data);
      });
    } else if (category === 'sex') {
      $.get("sexChart.html", function (data) {
        $(".chart-main").empty();
        $(".chart-main").append(data);
      });
    } else if (category === 'religion') {
      $.get("religionChart.html", function (data) {
        $(".chart-main").empty();
        $(".chart-main").append(data);
      });
    } else if (category === 'education') {
      $.get("educationLevelChart.html", function (data) {
        $(".chart-main").empty();
        $(".chart-main").append(data);
      });
    } else if (category === 'age') {
      $.get("ageChart.html", function (data) {
        $(".chart-main").empty();
        $(".chart-main").append(data);
      });
    }
  });

  async function getInferiorInfo(token, username) {
    const rawResponse = await fetch(`http://localhost:8000/departments?id=${username}`, {
      method: "GET",
      headers: {
        "Accept": "application/json",
        "Authorization": `Bearer ${token}`
      }
    });

    return rawResponse.json();
  }
</script>